---
name: service-backup

description: |
  Service Backup provides ability to upload the backup produced by a service
  to an S3-API-compatible blobstore.

templates:
  ctl.erb: bin/ctl

packages:
- service-backup
- aws-cli
- blobxfer

properties:

  ################################# BACKUP #################################

  service-backup.destination.s3.endpoint_url:
    default: https://s3.amazonaws.com
    description: URL of the blobstore endpoint. Override this to use an S3-compatible blobstore like RiakS2.

  service-backup.destination.s3.bucket_name:
    description: Bucket to which backups are uploaded

  service-backup.destination.s3.bucket_path:
    description: Path in bucket to which backups are uploaded

  service-backup.destination.s3.access_key_id:
    description: AWS Access Key to access the blobstore

  service-backup.destination.s3.secret_access_key:
    description: AWS Secret Access Key to access the blobstore


  service-backup.destination.scp.user:
    description: SCP user on remote server

  service-backup.destination.scp.server:
    description: SCP remote server host

  service-backup.destination.scp.destination:
    description: Remote path on server for upload

  service-backup.destination.scp.key:
    description: SSH key identity file for remote server

  service-backup.destination.scp.port:
    description: SSH port on remote server
    default: 22

  service-backup.destination.azure.storage_account:
    description: Azure account name to access the storage service

  service-backup.destination.azure.storage_access_key:
    description: Azure access key to access the storage service

  service-backup.destination.azure.container:
    description: Container to which backups are uploaded

  service-backup.destination.azure.path:
    description: Path in container to which backups are uploaded

  service-backup.destination.azure.blob_store_base_url:
    description: Path in url to which backups are uploaded
    default: core.windows.net


  service-backup.source_folder:
    description: Local path from which backups are uploaded. All files in here are uploaded.

  service-backup.source_executable:
    description: Local executable to create backups. Tokens are split on spaces; first is command to execute and remaining are passed as args to command.

  service-backup.cleanup_executable:
    description: Local executable to cleanup backups. Tokens are split on spaces; first is command to execute and remaining are passed as args to command.
    default: ""

  service-backup.cron_schedule:
    description: Schedule on which to perform backups. Supports "* * * * *" syntax.

  service-backup.missing_properties_message:
    default: Provide these missing fields in your manifest.
    description: Custom message to show when required backup parameters are not present.

  service-backup.service_identifier_executable:
    description: Local executable to identify the service. If provided the identifier is included in log messages. Tokens are split on spaces; first is command to execute and remaining are passed as args to command.

  service-backup.exit_if_in_progress:
    default: "false"
    description: Optional field to reject subsequent backup requests if a backup is already in progress. Defaults to false.
