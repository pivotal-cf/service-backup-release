---
name: service-backup

description: |
  Service Backup provides ability to upload the backup produced by a service
  to an S3-API-compatible blobstore.

templates:
  ctl.erb: bin/ctl
  backup.yml.erb: config/backup.yml
  manual-backup.sh.erb: bin/manual-backup
  gcp_service_account.json.erb: config/gcp_service_account.json

packages:
- service-backup
- aws-cli
- blobxfer
- python

properties:

  ################################# BACKUP #################################
  service-backup.destinations:
    default: []

  service-backup.source_folder:
    description: Local path from which backups are uploaded. All files in here are uploaded.

  service-backup.source_executable:
    description: Local executable to create backups. Tokens are split on spaces; first is command to execute and remaining are passed as args to command.

  service-backup.cleanup_executable:
    description: Local executable to cleanup backups. Tokens are split on spaces; first is command to execute and remaining are passed as args to command.
    default: ""

  service-backup.cron_schedule:
    description: Schedule on which to perform backups. Supports "* * * * *" syntax.

  service-backup.backup_user:
    default: vcap
    description: User which will run the backup daemon.

  service-backup.missing_properties_message:
    default: Provide these missing fields in your manifest.
    description: Custom message to show when required backup parameters are not present.

  service-backup.service_identifier_executable:
    description: Local executable to identify the service. If provided the identifier is included in log messages. Tokens are split on spaces; first is command to execute and remaining are passed as args to command.

  service-backup.exit_if_in_progress:
    default: "false"
    description: Optional field to reject subsequent backup requests if a backup is already in progress. Defaults to false.

  service-backup.aws_cli_path:
    default: /var/vcap/packages/aws-cli/bin/aws
    description: Path the to aws cli

  service-backup.azure_cli_path:
    default: /var/vcap/packages/blobxfer/bin/blobxfer
    description: Path the to azure cli
